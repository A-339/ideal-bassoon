<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健身计划制定器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f6f8fc 0%, #e9f0f7 100%);
            min-height: 100vh;
        }
        .input-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .input-card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 8px -1px rgba(37, 99, 235, 0.3);
        }
        .section-title {
            color: #1e40af;
            font-weight: 700;
            position: relative;
            padding-bottom: 0.5rem;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 3rem;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 3px;
        }
        .form-group {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        .form-group:hover {
            background: #f1f5f9;
        }
        .form-label {
            color: #475569;
            font-weight: 500;
        }
        .form-input {
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 0.5rem;
            transition: all 0.3s ease;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .checkbox-group {
            background: #f8fafc;
            border-radius: 0.5rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }
        .checkbox-group:hover {
            background: #f1f5f9;
        }
        .checkbox-label {
            color: #475569;
            font-weight: 500;
        }
        .required-badge {
            background: #fee2e2;
            color: #dc2626;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .optional-badge {
            background: #e0f2fe;
            color: #0284c7;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-left: 0.5rem;
        }
        .results-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-top: 2rem;
        }
        .progress-bar {
            height: 0.5rem;
            background: #e2e8f0;
            border-radius: 0.25rem;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 0.25rem;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="py-8 px-4 md:px-8">
    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">健身计划制定器</h1>
            <p class="text-lg text-gray-600">根据您的身体状况和目标，制定个性化的健身计划</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- 当前身体状况 -->
            <div class="input-card p-6">
                <h2 class="section-title text-2xl mb-6">当前身体状况</h2>
                <form id="currentForm" class="space-y-6">
                    <!-- 基本信息 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            基本信息
                            <span class="required-badge">必填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">身高 (cm)</label>
                                <input type="number" name="height" required class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">体重 (kg)</label>
                                <input type="number" name="weight" required class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 运动能力 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            运动能力
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">单杠数量（个）</label>
                                <input type="number" name="pullups" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">3公里用时（分钟）</label>
                                <input type="number" name="running" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">仰卧起坐（个/分钟）</label>
                                <input type="number" name="sit_ups" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">俯卧撑（个/分钟）</label>
                                <input type="number" name="push_ups" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">深蹲（个/分钟）</label>
                                <input type="number" name="squats" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">平板支撑（秒）</label>
                                <input type="number" name="plank" class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 心肺功能 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            心肺功能
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">静息心率（次/分钟）</label>
                                <input type="number" name="resting_heart_rate" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">最大摄氧量（ml/kg/min）</label>
                                <input type="number" name="vo2max" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">肺活量（ml）</label>
                                <input type="number" name="vital_capacity" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">心率恢复时间（分钟）</label>
                                <input type="number" name="heart_rate_recovery" class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 柔韧性 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            柔韧性
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">坐位体前屈（厘米）</label>
                                <input type="number" name="sit_and_reach" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">肩部柔韧性（厘米）</label>
                                <input type="number" name="shoulder_flexibility" class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 个人健康信息 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            个人健康信息
                            <span class="required-badge">必填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div>
                                <label class="form-label block mb-2">年龄</label>
                                <input type="number" name="age" required class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">性别</label>
                                <select name="gender" required class="form-input w-full">
                                    <option value="">请选择</option>
                                    <option value="male">男</option>
                                    <option value="female">女</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>健康状况：</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" name="health_conditions" value="none"> 无</label>
                                <label><input type="checkbox" name="health_conditions" value="heart_disease"> 心脏病</label>
                                <label><input type="checkbox" name="health_conditions" value="hypertension"> 高血压</label>
                                <label><input type="checkbox" name="health_conditions" value="diabetes"> 糖尿病</label>
                                <label><input type="checkbox" name="health_conditions" value="asthma"> 哮喘</label>
                                <label><input type="checkbox" name="health_conditions" value="joint_issues"> 关节问题</label>
                                <label><input type="checkbox" name="health_conditions" value="osteoporosis"> 骨质疏松</label>
                                <label><input type="checkbox" name="health_conditions" value="thyroid"> 甲状腺疾病</label>
                                <label><input type="checkbox" name="health_conditions" value="kidney_disease"> 肾脏疾病</label>
                                <label><input type="checkbox" name="health_conditions" value="liver_disease"> 肝脏疾病</label>
                                <label><input type="checkbox" name="health_conditions" value="arthritis"> 关节炎</label>
                                <label><input type="checkbox" name="health_conditions" value="depression"> 抑郁症</label>
                                <label><input type="checkbox" name="health_conditions" value="anxiety"> 焦虑症</label>
                                <label><input type="checkbox" name="health_conditions" value="sleep_disorder"> 睡眠障碍</label>
                                <label><input type="checkbox" name="health_conditions" value="digestive_issues"> 消化系统疾病</label>
                            </div>
                        </div>

                        <div class="checkbox-group mb-4">
                            <label class="form-label block mb-2">运动习惯</label>
                            <div class="grid grid-cols-1 gap-4">
                                <div class="flex items-center">
                                    <input type="checkbox" name="exercise_habits" value="none" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">无运动习惯</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" name="exercise_habits" value="regular" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">有规律运动</label>
                                </div>
                            </div>
                        </div>

                        <!-- 运动详情（当选择"有规律运动"时显示） -->
                        <div id="exerciseDetails" class="hidden space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="form-label block mb-2">每周运动频率</label>
                                    <select name="exercise_frequency" class="form-select">
                                        <option value="">请选择</option>
                                        <option value="1-2">1-2次/周</option>
                                        <option value="3-4">3-4次/周</option>
                                        <option value="5-6">5-6次/周</option>
                                        <option value="7+">7次以上/周</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label block mb-2">每次运动时长</label>
                                    <select name="exercise_duration" class="form-select">
                                        <option value="">请选择</option>
                                        <option value="30min">30分钟以内</option>
                                        <option value="30-60min">30-60分钟</option>
                                        <option value="60-90min">60-90分钟</option>
                                        <option value="90min+">90分钟以上</option>
                                    </select>
                                </div>
                            </div>

                            <div>
                                <label class="form-label block mb-2">主要运动项目（可多选）</label>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="running" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">跑步</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="swimming" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">游泳</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="cycling" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">骑行</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="gym" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">健身房</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="yoga" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">瑜伽</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="basketball" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">篮球</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="football" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">足球</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="badminton" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">羽毛球</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" name="exercise_types" value="other" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                        <label class="ml-2 text-sm text-gray-700">其他</label>
                                    </div>
                                </div>
                            </div>

                            <!-- 跑步详情 -->
                            <div id="runningDetails" class="hidden space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label block mb-2">平均每次跑步距离（公里）</label>
                                        <input type="number" name="running_distance" class="form-input" min="0" step="0.1">
                                    </div>
                                    <div>
                                        <label class="form-label block mb-2">平均配速（分钟/公里）</label>
                                        <input type="number" name="running_pace" class="form-input" min="0" step="0.1">
                                    </div>
                                </div>
                            </div>

                            <!-- 游泳详情 -->
                            <div id="swimmingDetails" class="hidden space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="form-label block mb-2">平均每次游泳距离（米）</label>
                                        <input type="number" name="swimming_distance" class="form-input" min="0" step="50">
                                    </div>
                                    <div>
                                        <label class="form-label block mb-2">主要泳姿</label>
                                        <select name="swimming_style" class="form-select">
                                            <option value="">请选择</option>
                                            <option value="freestyle">自由泳</option>
                                            <option value="breaststroke">蛙泳</option>
                                            <option value="backstroke">仰泳</option>
                                            <option value="butterfly">蝶泳</option>
                                            <option value="mixed">混合泳</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- 健身房详情 -->
                            <div id="gymDetails" class="hidden space-y-4">
                                <div>
                                    <label class="form-label block mb-2">主要训练项目（可多选）</label>
                                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                        <div class="flex items-center">
                                            <input type="checkbox" name="gym_types" value="strength" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">力量训练</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" name="gym_types" value="cardio" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">有氧训练</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" name="gym_types" value="hiit" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">HIIT</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" name="gym_types" value="yoga" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">瑜伽</label>
                                        </div>
                                        <div class="flex items-center">
                                            <input type="checkbox" name="gym_types" value="pilates" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                            <label class="ml-2 text-sm text-gray-700">普拉提</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="checkbox-group mb-4">
                            <label class="form-label block mb-2">饮食习惯</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <div class="flex items-center">
                                    <input type="checkbox" name="diet_habits" value="none" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">无</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" name="diet_habits" value="regular" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">规律饮食</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" name="diet_habits" value="irregular" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">不规律饮食</label>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" name="diet_habits" value="vegetarian" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <label class="ml-2 text-sm text-gray-700">素食</label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label block mb-2">平均每日睡眠时间（小时）</label>
                            <input type="number" name="sleep_hours" required class="form-input w-full">
                        </div>

                        <div>
                            <label class="form-label block mb-2">其他健康相关说明</label>
                            <textarea name="health_notes" rows="3" class="form-input w-full"></textarea>
                        </div>
                    </div>
                </form>
            </div>

            <!-- 目标身体状况 -->
            <div class="input-card p-6">
                <h2 class="section-title text-2xl mb-6">目标身体状况</h2>
                <form id="targetForm" class="space-y-6">
                    <!-- 基础目标 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            基础目标
                            <span class="required-badge">必填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">目标身高 (cm)</label>
                                <input type="number" name="targetHeight" required class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标体重 (kg)</label>
                                <input type="number" name="targetWeight" required class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 运动能力目标 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            运动能力目标
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">目标单杠数量（个）</label>
                                <input type="number" name="targetPullups" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标3公里用时（分钟）</label>
                                <input type="number" name="targetRunning" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标仰卧起坐（个/分钟）</label>
                                <input type="number" name="targetSitUps" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标俯卧撑（个/分钟）</label>
                                <input type="number" name="targetPushUps" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标深蹲（个/分钟）</label>
                                <input type="number" name="targetSquats" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标平板支撑（秒）</label>
                                <input type="number" name="targetPlank" class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 心肺功能目标 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            心肺功能目标
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">目标静息心率（次/分钟）</label>
                                <input type="number" name="targetRestingHeartRate" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标最大摄氧量（ml/kg/min）</label>
                                <input type="number" name="targetVo2max" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标肺活量（ml）</label>
                                <input type="number" name="targetVitalCapacity" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标心率恢复时间（分钟）</label>
                                <input type="number" name="targetHeartRateRecovery" class="form-input w-full">
                            </div>
                        </div>
                    </div>

                    <!-- 柔韧性目标 -->
                    <div class="form-group">
                        <h3 class="text-lg font-medium text-gray-700 mb-4">
                            柔韧性目标
                            <span class="optional-badge">选填</span>
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="form-label block mb-2">目标坐位体前屈（厘米）</label>
                                <input type="number" name="targetSitAndReach" class="form-input w-full">
                            </div>
                            <div>
                                <label class="form-label block mb-2">目标肩部柔韧性（厘米）</label>
                                <input type="number" name="targetShoulderFlexibility" class="form-input w-full">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="text-center mt-8">
            <button onclick="generatePlan()" class="btn-primary">
                生成健身计划
            </button>
        </div>

        <div id="results" class="results-card hidden">
            <!-- 结果内容将通过JavaScript动态生成 -->
        </div>
    </div>

    <script>
        // 天气状态定义
        const WEATHER_CONDITIONS = {
            RAIN: '雨',
            SNOW: '雪',
            THUNDERSTORM: '雷',
            DRIZZLE: '小雨',
            CLEAR: '晴',
            CLOUDS: '多云',
            MIST: '雾',
            SMOKE: '霾',
            HAZE: '霾',
            DUST: '沙尘',
            FOG: '雾',
            SAND: '沙尘',
            ASH: '浮尘',
            SQUALL: '大风',
            TORNADO: '龙卷风'
        };

        // 获取天气信息
        async function getWeatherData(city) {
            try {
                // 使用中国天气网的数据
                const response = await fetch(`https://weather.cma.cn/api/now/${encodeURIComponent(city)}`);
                const data = await response.json();
                
                if (data.code === 0) {
                    const weatherInfo = data.data;
                    return {
                        temperature: weatherInfo.temperature,
                        condition: weatherInfo.weather,
                        description: weatherInfo.weather,
                        humidity: weatherInfo.humidity,
                        windSpeed: weatherInfo.windSpeed,
                        windDirection: weatherInfo.windDirection,
                        updateTime: weatherInfo.updateTime
                    };
                } else {
                    console.error('获取天气信息失败:', data.message);
                    return null;
                }
            } catch (error) {
                console.error('获取天气信息失败:', error);
                return null;
            }
        }

        // 根据天气调整运动计划
        function adjustWorkoutPlanForWeather(workoutPlan, weatherData) {
            if (!weatherData) return workoutPlan;

            const { temperature, condition, humidity, windSpeed, windDirection } = weatherData;
            let adjustedPlan = [...workoutPlan];
            let weatherAdvice = [];

            // 根据温度调整
            if (temperature > 30) {
                weatherAdvice.push("高温天气注意事项：");
                weatherAdvice.push("- 避免在正午时分进行户外运动");
                weatherAdvice.push("- 增加水分补充频率");
                weatherAdvice.push("- 降低运动强度");
                weatherAdvice.push("- 选择阴凉处进行运动");
            } else if (temperature < 5) {
                weatherAdvice.push("低温天气注意事项：");
                weatherAdvice.push("- 充分做好热身运动");
                weatherAdvice.push("- 穿着适当的保暖衣物");
                weatherAdvice.push("- 避免在清晨和夜晚进行户外运动");
                weatherAdvice.push("- 考虑转为室内运动");
            }

            // 根据天气状况调整
            if (condition.includes('雨')) {
                weatherAdvice.push("雨天运动建议：");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 如果坚持户外运动，请穿着防雨装备");
                weatherAdvice.push("- 注意地面湿滑，降低运动强度");
            } else if (condition.includes('雪')) {
                weatherAdvice.push("雪天运动建议：");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 如果进行户外运动，注意防滑");
                weatherAdvice.push("- 穿着保暖防滑的装备");
            } else if (condition.includes('雷')) {
                weatherAdvice.push("雷雨天气警告：");
                weatherAdvice.push("- 禁止户外运动");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 等待天气好转后再进行户外活动");
            } else if (condition.includes('晴')) {
                weatherAdvice.push("晴天运动建议：");
                weatherAdvice.push("- 注意防晒");
                weatherAdvice.push("- 选择适当的运动时间");
                weatherAdvice.push("- 保持充足的水分补充");
            } else if (condition.includes('多云')) {
                weatherAdvice.push("多云天气运动建议：");
                weatherAdvice.push("- 适合进行户外运动");
                weatherAdvice.push("- 注意观察天气变化");
                weatherAdvice.push("- 准备适当的防晒措施");
            } else if (condition.includes('雾') || condition.includes('霾')) {
                weatherAdvice.push("雾霾天气注意事项：");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 避免剧烈运动");
                weatherAdvice.push("- 注意防护措施");
            } else if (condition.includes('沙尘')) {
                weatherAdvice.push("沙尘天气注意事项：");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 避免户外运动");
                weatherAdvice.push("- 注意防护措施");
            }

            // 根据湿度调整
            if (humidity > 80) {
                weatherAdvice.push("高湿度天气注意事项：");
                weatherAdvice.push("- 降低运动强度");
                weatherAdvice.push("- 增加休息时间");
                weatherAdvice.push("- 注意补充电解质");
            }

            // 根据风速调整
            if (windSpeed > 20) {
                weatherAdvice.push("大风天气注意事项：");
                weatherAdvice.push("- 避免进行户外运动");
                weatherAdvice.push("- 建议转为室内运动");
                weatherAdvice.push("- 注意保暖防风");
            }

            // 添加天气建议到计划中
            if (weatherAdvice.length > 0) {
                adjustedPlan.push("\n=== 天气相关建议 ===");
                adjustedPlan.push(`当前天气：${condition}，温度：${temperature}℃，湿度：${humidity}%，风速：${windSpeed}km/h，风向：${windDirection}`);
                adjustedPlan.push(`更新时间：${weatherData.updateTime}`);
                adjustedPlan.push(...weatherAdvice);
            }

            return adjustedPlan;
        }

        // 修改表单，添加城市输入
        document.getElementById('fitnessForm').innerHTML += `
            <div class="form-group">
                <label>所在城市：</label>
                <input type="text" name="city" class="form-control" placeholder="请输入您所在的城市（如：北京、上海）" required>
                <small class="text-gray-500">请输入准确的城市名称，以便获取准确的天气信息</small>
            </div>
        `;

        // 修改表单提交处理
        document.getElementById('fitnessForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // ... existing form data collection ...

            // 添加城市信息
            const formData = new FormData(this);
            const city = formData.get('city');
            
            // 生成计划
            const plan = await generateFitnessPlan(currentData, targetData);
            
            // ... rest of the existing code ...
        });
    </script>
</body>
</html> 